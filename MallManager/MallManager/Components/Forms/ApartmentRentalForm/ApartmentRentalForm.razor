@using MallManager.Service
@inject RetailUnitService RetailUnitService

<EditForm Model="@_rentalForm" OnValidSubmit="OnValidSubmit">
    <DataAnnotationsValidator/>
    <MudStack Row="true">
        <MudStack Class="purpose-form">
            <MudStack Row="true">
                <MudSelect T="string" For="() => _rentalForm.SurfaceClassDictName" @bind-Value="_rentalForm.SurfaceClassDictName" Label="Metraż*" Variant="Variant.Filled">
                    @foreach (var surfaceClass in RetailUnitService.SurfaceClassDicts)
                    {
                        <MudSelectItem Value="@surfaceClass.Name">@RetailUnitService.SurfaceClassDictsAsString(surfaceClass)</MudSelectItem>
                    }
                </MudSelect>

                <MudSelect T="string" For="() => _rentalForm.RetailUnitPurposeName" @bind-Value="_rentalForm.RetailUnitPurposeName" Label="Typ działalności*" Variant="Variant.Filled" OnChange="@ApplyFilter">
                    @foreach (var retailUnitPurpose in RetailUnitService.RetailUnitPurposes)
                    {
                        <MudSelectItem Value="@retailUnitPurpose.Name">@retailUnitPurpose.Name</MudSelectItem>
                    }
                </MudSelect>
            </MudStack>

            <MudText Typo="Typo.caption" Class="mt-20">Okres Wynajmu*</MudText>

            <MudStack Row="true">
                <MudDatePicker @bind-Date="_rentalForm.StartDate" For="() => _rentalForm.StartDate" Label="Od*" Variant="Variant.Filled" />
                <MudDatePicker @bind-Date="_rentalForm.EndDate" For="() => _rentalForm.EndDate" Label="Do*" Variant="Variant.Filled" />
            </MudStack>
        </MudStack>

        <MudStack>
            <MudRadioGroup T="int" For="() => _rentalForm.RentalUnitId" @bind-SelectedOption="_rentalForm.RentalUnitId">
                <MudTable Items="_filteredRetailUnits">
                    <HeaderContent>
                        <MudTh>Kod lokalu</MudTh>
                        <MudTh>Piętro</MudTh>
                        <MudTh>Numer lokalu</MudTh>
                        <MudTh>Powierzchnia [metrów kwadratowych]</MudTh>
                        <MudTh>Wybierz</MudTh>
                    </HeaderContent>
                    <RowTemplate Context="item">
                        <MudTd>@item.Id</MudTd>
                        <MudTd>@item.FloorNumber</MudTd>
                        <MudTd>@item.LocalNumber</MudTd>
                        <MudTd>@item.LocalSurfaceArea</MudTd>
                        <MudTd>
                            <MudRadio Value="@item.Id"></MudRadio>
                        </MudTd>
                    </RowTemplate>
                </MudTable>
            </MudRadioGroup>
        </MudStack>
    </MudStack>

    <MudStack>
        <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary"
                   Class="ml-auto">
            Zatwierdź
        </MudButton>
    </MudStack>
</EditForm>