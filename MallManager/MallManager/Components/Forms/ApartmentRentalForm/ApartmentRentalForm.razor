@using MallManager.Service
@using Shared.Core.Entities
@inject RetailUnitService RetailUnitService

<EditForm Model="@RentalForm" OnValidSubmit="OnValidSubmit">
    <MudStack Row="true">
        <MudStack Class="purpose-form">
            <MudStack Row="true">
                <MudSelect T="SurfaceClassDict" For="() => RentalForm.SurfaceClassDict" Required="true" @bind-Value="RentalForm.SurfaceClassDict" Label="Metraż" Variant="Variant.Filled" ValueChanged="@ApplyFilter">
                    @foreach (var surfaceClass in RetailUnitService.SurfaceClassDicts)
                    {
                        <MudSelectItem Value="@surfaceClass">@RetailUnitService.SurfaceClassDictsAsString(surfaceClass)</MudSelectItem>
                    }
                </MudSelect>

                <MudSelect T="RetailUnitPurpose" For="() => RentalForm.RetailUnitPurpose" @bind-Value="RentalForm.RetailUnitPurpose" Label="Typ działalności" Variant="Variant.Filled" OnChange="@ApplyFilter">
                    @foreach (var retailUnitPurpose in RetailUnitService.RetailUnitPurposes)
                    {
                        <MudSelectItem Value="@retailUnitPurpose">@retailUnitPurpose.Name</MudSelectItem>
                    }
                </MudSelect>
            </MudStack>

            <MudText Typo="Typo.caption" Class="mt-20">Okres Wynajmu*</MudText>

            <MudStack Row="true">
                <MudDatePicker @bind-Date="RentalForm.StartDate" For="() => RentalForm.StartDate" Label="Od" Variant="Variant.Filled" Validation="ValidateStartDate" OnChange="@ApplyFilter"/>
                <MudDatePicker @bind-Date="RentalForm.EndDate"  For="() => RentalForm.EndDate" Label="Do" Variant="Variant.Filled" Validation="ValidateEndDate" OnChange="@ApplyFilter"/>

                <MudText Typo="Typo.subtitle1" Color="Color.Error" Hidden="@string.IsNullOrEmpty(_errorMessage)">@_errorMessage</MudText>
            </MudStack>
        </MudStack>

        <MudStack>
            <MudRadioGroup T="RetailUnit" For="() => RentalForm.SelectedRetailUnit" @bind-SelectedOption="RentalForm.SelectedRetailUnit">
                <MudTable Items="_filteredRetailUnits">
                    <HeaderContent>
                        <MudTh>Kod lokalu</MudTh>
                        <MudTh>Piętro</MudTh>
                        <MudTh>Numer lokalu</MudTh>
                        <MudTh>Powierzchnia [metrów kwadratowych]</MudTh>
                        <MudTh>Wybierz</MudTh>
                    </HeaderContent>
                    <RowTemplate Context="item">
                        <MudTd>@item.Id</MudTd>
                        <MudTd>@item.FloorNumber</MudTd>
                        <MudTd>@item.LocalNumber</MudTd>
                        <MudTd>@item.LocalSurfaceArea</MudTd>
                        <MudTd>
                            <MudRadio Value="@item"></MudRadio>
                        </MudTd>
                    </RowTemplate>
                </MudTable>
            </MudRadioGroup>
        </MudStack>
    </MudStack>

    <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary"
               Class="ml-auto">
        Zatwierdź
    </MudButton>
</EditForm>